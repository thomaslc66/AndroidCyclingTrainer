<html>
<head>
<title>RealmDB.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(98,151,85); font-style: italic; }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(204,120,50); }
.s3 { color: rgb(98,151,85); font-weight: bold; font-style: italic; }
.s4 { color: rgb(128,128,128); }
.s5 { color: rgb(106,135,89); }
.s6 { color: rgb(104,151,187); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
RealmDB.java</FONT>
</center></TD></TR></TABLE>
<pre>

<span class="s0">/*************************************************************** 
 * Programm  : Android Cycling Trainer 
 * Society   : ETML 
 * Author    : Thomas LÃ©chaire 
 * Date      : 26.05.2015 
 * Goal      : This class regroups all method to manage the data base 
 ******************************************************************** // 
 * Modifications: 
 * Date       : XX.XX.XXXX 
 * Author     : 
 * Purpose    : 
 *********************************************************************/</span><span class="s1"> 
</span><span class="s2">package </span><span class="s1">tpi.lechaireth.com.androidcyclingtrainer.DB</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">android.content.Context</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.util.Log</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">android.widget.Toast</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">java.util.ArrayList</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">java.util.Calendar</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">java.util.List</span><span class="s2">;</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">io.realm.Realm</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">io.realm.RealmList</span><span class="s2">;</span><span class="s1"> 
</span><span class="s2">import </span><span class="s1">io.realm.RealmResults</span><span class="s2">;</span><span class="s1"> 
 
 
</span><span class="s0">/*********************************** 
 * begining of the class RealmDB 
 ************************************/</span><span class="s1"> 
</span><span class="s2">public class </span><span class="s1">RealmDB { 
 
    </span><span class="s2">private </span><span class="s1">Realm realm</span><span class="s2">;</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">Context context</span><span class="s2">;</span><span class="s1"> 
 
    </span><span class="s0">/********************************************************* 
     * Name: -&gt; Constructor for the class 
     * </span><span class="s3">@param </span><span class="s0">context 
     * return: empty 
     * Goal: create a new instance of RealmDB to acces all the management method 
     * 
     ********************************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">RealmDB(Context context) { 
        </span><span class="s4">//get the context of the Activity and set it to the RealmDB object</span><span class="s1"> 
        </span><span class="s2">this</span><span class="s1">.context = context</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s2">public void </span><span class="s1">close(){ 
        </span><span class="s4">//close realm instance</span><span class="s1"> 
        realm.close()</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s4">//############################################################# PART FOR TRAINING CLASS OPERATION ##############################################################################</span><span class="s1"> 
 
    </span><span class="s0">/********************************************************* 
     * 
     * Name: isUnique 
     * </span><span class="s3">@param </span><span class="s0">name 
     * </span><span class="s3">@return </span><span class="s0">boolean notUnique 
     * Goal: check if the name is already taken 
     * 
     ********************************************************/</span><span class="s1"> 
    </span><span class="s2">public boolean </span><span class="s1">isUnique(String name){ 
        </span><span class="s2">boolean </span><span class="s1">isNotUnique = </span><span class="s2">true;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//All writes must be wrapped in a transaction to facilitate safe multi threading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//find all training equal to the name we passed in parameters (str_name)</span><span class="s1"> 
        RealmResults results = realm.where(Training.</span><span class="s2">class</span><span class="s1">).equalTo(</span><span class="s5">&quot;str_name&quot;</span><span class="s2">, </span><span class="s1">name).findAll()</span><span class="s2">;</span><span class="s4">//send transaction</span><span class="s1"> 
        </span><span class="s4">//end of transaction</span><span class="s1"> 
        realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//Try to add a row</span><span class="s1"> 
        </span><span class="s2">if</span><span class="s1">(results.size() &gt; </span><span class="s6">0</span><span class="s1">){ 
            isNotUnique = </span><span class="s2">false;</span><span class="s1"> 
        } 
 
        </span><span class="s2">return </span><span class="s1">isNotUnique</span><span class="s2">;</span><span class="s1"> 
    } 
    </span><span class="s0">/********************************************************* 
     * 
     * Name: createTrainig 
     * </span><span class="s3">@param </span><span class="s0">name 
     * Goal: Method used to create a new training 
     * 
     ********************************************************/</span><span class="s1"> 
    </span><span class="s2">public void </span><span class="s1">createTraining(String name</span><span class="s2">, boolean </span><span class="s1">isVtt){ 
        </span><span class="s2">int </span><span class="s1">id</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//All writes must be wrapped in a transaction to facilitate safe multi threading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//find all training</span><span class="s1"> 
        RealmResults results = realm.where(Training.</span><span class="s2">class</span><span class="s1">).findAll()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//find the training with the max id and get the id</span><span class="s1"> 
        id = results.size()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//Try to add a row</span><span class="s1"> 
        </span><span class="s2">try</span><span class="s1">{ 
            </span><span class="s4">//Transaction began before -&gt;realm.bedinTransaction();</span><span class="s1"> 
            </span><span class="s4">//Get date of the day with the calendar</span><span class="s1"> 
            Calendar calendar = Calendar.getInstance()</span><span class="s2">;</span><span class="s1"> 
            calendar.getTime()</span><span class="s2">;</span><span class="s1"> 
 
            </span><span class="s2">int </span><span class="s1">year = calendar.get(Calendar.YEAR)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s2">int </span><span class="s1">month = calendar.get(Calendar.MONTH)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s2">int </span><span class="s1">dayMonth = calendar.get(Calendar.DAY_OF_MONTH)</span><span class="s2">;</span><span class="s1"> 
 
            </span><span class="s4">//Add a trainingRow by creating a new realmObject with the class TrainingRow</span><span class="s1"> 
            Training training = realm.createObject(Training.</span><span class="s2">class</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//set the id and the name of the training</span><span class="s1"> 
            training.setInt_id(id)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//set the name</span><span class="s1"> 
            training.setStr_name(name)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//set the date</span><span class="s1"> 
            training.setStr_day(dayMonth + </span><span class="s5">&quot;/&quot; </span><span class="s1">+ month + </span><span class="s5">&quot;/&quot; </span><span class="s1">+ year)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//training set isVTT</span><span class="s1"> 
            training.setBln_isVtt(isVtt)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit the transaction</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//catch Exceptions</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ 
            </span><span class="s4">//get error message</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//clear transaction - we don't want to add an empty or partial row</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//get status</span><span class="s1"> 
            Toast.makeText(context</span><span class="s2">,</span><span class="s5">&quot;Error.. Training not created&quot;</span><span class="s2">,</span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s4">//catch</span><span class="s1"> 
 
    }</span><span class="s4">//createTraining</span><span class="s1"> 
 
    </span><span class="s0">/***************************************************************************** 
     * 
     * addAtrainingRowToTraining 
     * </span><span class="s3">@param </span><span class="s0">realm_training_ID 
     * </span><span class="s3">@param </span><span class="s0">row 
     * Goal: Method that add a row to a training session 
     * 
     * *****************************************************************************/</span><span class="s1"> 
    </span><span class="s2">public void </span><span class="s1">addAtrainingRowToTraining(</span><span class="s2">int </span><span class="s1">realm_training_ID</span><span class="s2">, </span><span class="s1">TrainingRow row){ 
        </span><span class="s2">int </span><span class="s1">_id = </span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// no transaction because it has started in createRow Method</span><span class="s1"> 
        </span><span class="s4">//Try to add a row</span><span class="s1"> 
        </span><span class="s2">try</span><span class="s1">{ 
            </span><span class="s4">//get the training with realm_training_ID</span><span class="s1"> 
            Training training = realm.where(Training.</span><span class="s2">class</span><span class="s1">).equalTo(</span><span class="s5">&quot;id&quot;</span><span class="s2">,</span><span class="s1">realm_training_ID).findAll().first()</span><span class="s2">;</span><span class="s1">
            </span><span class="s4">//From this training get the List of TrainingRow.</span><span class="s1"> 
            RealmList&lt;TrainingRow&gt; trainingRows = training.getRlst_row()</span><span class="s2">;</span><span class="s1"> 
 
            </span><span class="s4">// Search for the last row and get is id.</span><span class="s1"> 
            </span><span class="s2">if</span><span class="s1">(trainingRows.size() &gt; </span><span class="s6">0</span><span class="s1">) { 
                _id = trainingRows.last().getInt_id()</span><span class="s2">;</span><span class="s1"> 
            } 
            </span><span class="s4">//check value of id</span><span class="s1"> 
            Log.w(</span><span class="s5">&quot;_ID&quot;</span><span class="s2">, </span><span class="s1">_id + </span><span class="s5">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//set row is id = id of the last row of the trainingDay + 1;</span><span class="s1"> 
            row.setInt_id(_id++)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//get list and add row to it.</span><span class="s1"> 
            training.getRlst_row().add(row)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit the transaction</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//catch Exceptions</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ 
            </span><span class="s4">//get error message</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//clear transaction - we don't want to add an empty or partial row</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//get status</span><span class="s1"> 
            Toast.makeText(context</span><span class="s2">,</span><span class="s5">&quot;Row not added to training &quot;</span><span class="s2">,</span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s4">//catch</span><span class="s1"> 
 
    }</span><span class="s4">//createRow</span><span class="s1"> 
 
 
    </span><span class="s0">/*************************************************** 
     * Name: getListOfTraining 
     * </span><span class="s3">@return </span><span class="s0">List</span><span class="s1">&lt;</span><span class="s0">Training</span><span class="s1">&gt;</span><span class="s0"> 
     * Goal: this method return all the training in the database 
     * 
     ***************************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">List&lt;Training&gt; getListOfTraining(){ 
        </span><span class="s4">//arrayList for the return</span><span class="s1"> 
        List&lt;Training&gt; t = </span><span class="s2">new </span><span class="s1">ArrayList&lt;&gt;()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//start transaction</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try </span><span class="s1">{ 
            </span><span class="s4">//get all the training from the data base</span><span class="s1"> 
            RealmResults&lt;Training&gt; realmResults = realm.where(Training.</span><span class="s2">class</span><span class="s1">).findAll()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//pass all the training from a RealmReasults list to a ArrayList</span><span class="s1"> 
            </span><span class="s2">for</span><span class="s1">(Training item : realmResults){ 
                </span><span class="s4">//add item in the ArrayList t</span><span class="s1"> 
                t.add(item)</span><span class="s2">;</span><span class="s1"> 
            }</span><span class="s4">//for</span><span class="s1"> 
            </span><span class="s4">//commit Transaction</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ </span><span class="s4">//catch Exceptions</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//in case of error cancel the transaction</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
        } 
 
        </span><span class="s4">//return the list</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">t</span><span class="s2">;</span><span class="s1"> 
    } 
 
 
    </span><span class="s0">/*************************************************** 
     * 
     * Name: getTraining 
     * </span><span class="s3">@param </span><span class="s0">name 
     * </span><span class="s3">@return </span><span class="s0">Training t 
     * Goal: this method return a Training with is name 
     * 
     *************************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">Training getTraining(String name){ 
        </span><span class="s4">//Create Variable</span><span class="s1"> 
        Training t = </span><span class="s2">null;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//All writes must be wrapped in a transaction to facilitate safe multi threading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try </span><span class="s1">{ 
            </span><span class="s4">//searching for the training with is name</span><span class="s1"> 
            t = realm.where(Training.</span><span class="s2">class</span><span class="s1">).equalTo(</span><span class="s5">&quot;str_name&quot;</span><span class="s2">, </span><span class="s1">name).findAll().first()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit the transaction</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ </span><span class="s4">//catch Exceptions</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//in cas of error cancel the transaction</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
        } 
 
        </span><span class="s4">//return the training</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">t</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">/********************************************************* 
     * 
     * removeTrainingWithID 
     * </span><span class="s3">@param </span><span class="s0">realm_training_ID 
     * Goal: Remove the training with his id 
     * NOT USED - NEEDED TIME TO ADD IT IN THE CODE 
     * 
     *******************************************************/</span><span class="s1"> 
    </span><span class="s2">public void </span><span class="s1">removeTrainingWithID(</span><span class="s2">int </span><span class="s1">realm_training_ID){ 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//All writes must be wrapped in a transaction to facilitate safe multi threading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try </span><span class="s1">{ 
            </span><span class="s4">//find the training with his id</span><span class="s1"> 
            Training training = realm.where(Training.</span><span class="s2">class</span><span class="s1">).equalTo(</span><span class="s5">&quot;id&quot;</span><span class="s2">, </span><span class="s1">realm_training_ID).findAll().first()</span><span class="s2">;</span><span class="s1">
            </span><span class="s4">//remove the training from the DB</span><span class="s1"> 
            training.removeFromRealm()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//catch Exceptions</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//cancel transaction</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
        } 
 
    } 
 
    </span><span class="s0">/********************************************** 
     * 
     * Name: getATrainingWithID 
     * </span><span class="s3">@param </span><span class="s0">id 
     * </span><span class="s3">@return </span><span class="s0">Training 
     * Goal: find and return a training using his ID 
     * 
     ********************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">Training getATrainingWithID(</span><span class="s2">int </span><span class="s1">id){ 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//start transaction</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//Create training object</span><span class="s1"> 
        Training training = </span><span class="s2">null;</span><span class="s1"> 
 
        </span><span class="s2">try</span><span class="s1">{ 
            </span><span class="s4">//get all and find into the training with the id</span><span class="s1"> 
            training = realm.where(Training.</span><span class="s2">class</span><span class="s1">).findAll().get(id)</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ 
            Toast.makeText(context</span><span class="s2">,</span><span class="s5">&quot;Erreur de rÃ©cupÃ©ration de l'entraÃ®nement&quot;</span><span class="s2">,</span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
 
        } 
 
        </span><span class="s4">//return results</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">training</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">/********************************************************* 
     * 
     * Name: removeTrainingWithID 
     * </span><span class="s3">@param </span><span class="s0">t 
     * Goal: Remove the training passed in parameter 
     * 
     *******************************************************/</span><span class="s1"> 
    </span><span class="s2">public void </span><span class="s1">removeTraining (Training t){ 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//start transaction to facilitate multithreading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try </span><span class="s1">{ 
            </span><span class="s4">//remove the training from the DB</span><span class="s1"> 
            t.removeFromRealm()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit the transaction</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ </span><span class="s4">//catch Exceptions</span><span class="s1"> 
            </span><span class="s4">//print error message</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//if and Exceptions is catched we need to cancel the transaction</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
        } 
 
    } 
 
 
    </span><span class="s4">//############################################################# PART FOR TRAINIG ROW CLASS OPERATION ##############################################################################</span><span class="s1"> 
 
    </span><span class="s0">/************************************************************* 
     * 
     * Name: getAllTrainingRows 
     * </span><span class="s3">@param </span><span class="s0">realm_training_id 
     * </span><span class="s3">@return </span><span class="s0">a list of training Row 
     * Goal: By id we get a training a we get all the row within this training 
     * 
     * ***********************************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">List&lt;TrainingRow&gt; getAllTrainingRows(</span><span class="s2">int </span><span class="s1">realm_training_id){ 
        Log.w(</span><span class="s5">&quot;ID TRAINING&quot;</span><span class="s2">, </span><span class="s1">realm_training_id+</span><span class="s5">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        List&lt;TrainingRow&gt; list_of_row</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//start transaction</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try</span><span class="s1">{ 
            </span><span class="s4">//get the training with the id</span><span class="s1"> 
            Training t = realm.where(Training.</span><span class="s2">class</span><span class="s1">).equalTo(</span><span class="s5">&quot;id&quot;</span><span class="s2">,</span><span class="s1">realm_training_id).findAll().first()</span><span class="s2">;</span><span class="s1">
            </span><span class="s4">//then get the list of row contained in the training</span><span class="s1"> 
            list_of_row = t.getRlst_row()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit the transcation</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ </span><span class="s4">//catch Exceptions</span><span class="s1"> 
            </span><span class="s4">//print error message in logcat</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//if Exception is catched cancel the transaction</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//and set the list to null</span><span class="s1"> 
            list_of_row = </span><span class="s2">null;</span><span class="s1"> 
        } 
 
        </span><span class="s4">//return the list of all rows</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">list_of_row</span><span class="s2">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">/******************************************************************** 
     * 
     * Name: createRow 
     * </span><span class="s3">@param </span><span class="s0">min_work 
     * </span><span class="s3">@param </span><span class="s0">sec_work 
     * </span><span class="s3">@param </span><span class="s0">tour 
     * </span><span class="s3">@param </span><span class="s0">bpm 
     * </span><span class="s3">@param </span><span class="s0">min_recup 
     * </span><span class="s3">@param </span><span class="s0">sec_recup 
     * </span><span class="s3">@param </span><span class="s0">str_gear 
     * </span><span class="s3">@param </span><span class="s0">str_work 
     * </span><span class="s3">@param </span><span class="s0">str_rythm 
     * </span><span class="s3">@param </span><span class="s0">str_note 
     * </span><span class="s3">@return </span><span class="s0">TrainingRow 
     * Goal: method used to add a training row in the realm db 
     * 
     ******************************************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">TrainingRow createRow(</span><span class="s2">int </span><span class="s1">min_work</span><span class="s2">, int </span><span class="s1">sec_work</span><span class="s2">, int </span><span class="s1">tour</span><span class="s2">, int </span><span class="s1">bpm</span><span class="s2">, int </span><span class="s1">min_recup</span><span class="s2">, int </span><span class="s1">sec_recup</span><span class="s2">, </span><span class="s1">String str_gear</span><span class="s2">, </span><span class="s1">String str_work</span><span class="s2">, </span><span class="s1">String str_rythm</span><span class="s2">, </span><span class="s1">String str_note ){ 
        TrainingRow trainingRow</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//All writes must be wrapped in a transaction to facilitate safe multi threading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//Add a trainingRow by creating a new realmObject with the class TrainingRow</span><span class="s1"> 
        trainingRow = realm.createObject(TrainingRow.</span><span class="s2">class</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//set min</span><span class="s1"> 
        trainingRow.setInt_min(min_work)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//set sec</span><span class="s1"> 
        trainingRow.setInt_sec(sec_work)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//set tpm</span><span class="s1"> 
        trainingRow.setInt_rpm(tour)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//set heart beat</span><span class="s1"> 
        trainingRow.setInt_bpm(bpm)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set min for rest time</span><span class="s1"> 
        trainingRow.setInt_min_rest(min_recup)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set seconds for rest time</span><span class="s1"> 
        trainingRow.setInt_sec_rest(sec_recup)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set String for the work</span><span class="s1"> 
        trainingRow.setStr_work(str_work)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set String for the rythm</span><span class="s1"> 
        trainingRow.setStr_rythm(str_rythm)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set String for the front and black gear</span><span class="s1"> 
        trainingRow.setStr_gear(str_gear)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set String for the note</span><span class="s1"> 
        trainingRow.setStr_note(str_note)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set String for the work time, used for the display</span><span class="s1"> 
        trainingRow.setStr_time(setTimeWithInt(min_work</span><span class="s2">, </span><span class="s1">sec_work))</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">// set String for the rest time, used for the display</span><span class="s1"> 
        trainingRow.setStr_time_rest(setTimeWithInt(min_recup</span><span class="s2">, </span><span class="s1">sec_recup))</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s4">//return the traing row freshly created+</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">trainingRow</span><span class="s2">;</span><span class="s1"> 
    }</span><span class="s4">//createRow</span><span class="s1"> 
 
 
    </span><span class="s0">/***************************************************************************** 
     * 
     * Name: removeRowWithID 
     * </span><span class="s3">@param </span><span class="s0">realm_Row_ID 
     * Goal: method used to remove a row from the training 
     * 
     *****************************************************************************/</span><span class="s1"> 
    </span><span class="s2">public void </span><span class="s1">removeRowWithID(</span><span class="s2">int </span><span class="s1">realm_Row_ID){ 
        </span><span class="s4">//get instance of Realm</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//begin a transaction to facilitate safe multi threading</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try </span><span class="s1">{ 
            </span><span class="s4">//find the training row equal to the id passed in parameter</span><span class="s1"> 
            TrainingRow trainingRow = realm.where(TrainingRow.</span><span class="s2">class</span><span class="s1">).equalTo(</span><span class="s5">&quot;id&quot;</span><span class="s2">, </span><span class="s1">realm_Row_ID).findAll().first()</span><span class="s2">;</span><span class="s1">
            </span><span class="s4">//remove the row</span><span class="s1"> 
            trainingRow.removeFromRealm()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//commit the transaction</span><span class="s1"> 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ </span><span class="s4">//catch Exceptions</span><span class="s1"> 
            e.printStackTrace()</span><span class="s2">;</span><span class="s4">// print error message in logcat</span><span class="s1"> 
            </span><span class="s4">//if Exception is catched cancel the transaction</span><span class="s1"> 
            realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
        } 
 
    } 
 
    </span><span class="s0">/*************************************************** 
     * 
     * Name: getArowWithID 
     * </span><span class="s3">@param </span><span class="s0">id 
     * </span><span class="s3">@return</span><span class="s0"> 
     * 
     **************************************************/</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">TrainingRow getArowWithID(</span><span class="s2">int </span><span class="s1">id){ 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        realm.beginTransaction()</span><span class="s2">;</span><span class="s1"> 
        TrainingRow trainingRow = </span><span class="s2">null;</span><span class="s1"> 
        RealmResults&lt;TrainingRow&gt; realmResults = realm.where(TrainingRow.</span><span class="s2">class</span><span class="s1">).findAll()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">try</span><span class="s1">{ 
            </span><span class="s2">if </span><span class="s1">(realmResults.size() &gt; </span><span class="s6">0</span><span class="s1">){ 
                trainingRow = realmResults.get(id)</span><span class="s2">;</span><span class="s1"> 
                realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
            }</span><span class="s2">else</span><span class="s1">{ 
 
                Toast.makeText(context</span><span class="s2">,</span><span class="s5">&quot;Erreur d'affichage&quot;</span><span class="s2">,</span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s2">;</span><span class="s1"> 
                realm.cancelTransaction()</span><span class="s2">;</span><span class="s1"> 
            } 
        }</span><span class="s2">catch </span><span class="s1">(Exception e){ 
            realm.commitTransaction()</span><span class="s2">;</span><span class="s1"> 
 
        } 
 
        </span><span class="s2">return </span><span class="s1">trainingRow</span><span class="s2">;</span><span class="s1"> 
    } 
 
 
    </span><span class="s0">/***************************************************** 
     * 
     * </span><span class="s3">@param </span><span class="s0">min 
     * </span><span class="s3">@param </span><span class="s0">sec 
     * </span><span class="s3">@return </span><span class="s0">String time 
     * Goal: return the time in a string format 
     *       set String time with zero before minus 10 number 
     *******************************************************/</span><span class="s1"> 
    </span><span class="s2">private </span><span class="s1">String setTimeWithInt(</span><span class="s2">int </span><span class="s1">min</span><span class="s2">, int </span><span class="s1">sec) { 
        String time = </span><span class="s5">&quot;&quot;</span><span class="s2">;</span><span class="s1"> 
        Log.w(</span><span class="s5">&quot;TAG SEC &quot;</span><span class="s2">, </span><span class="s1">sec+</span><span class="s5">&quot;&quot;</span><span class="s1">)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">if</span><span class="s1">(min &lt; </span><span class="s6">10</span><span class="s1">){ 
            time = </span><span class="s5">&quot;0&quot;</span><span class="s1">+min</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">else</span><span class="s1">{ 
            time = </span><span class="s5">&quot;&quot;</span><span class="s1">+min</span><span class="s2">;</span><span class="s1"> 
        } 
 
        </span><span class="s2">if </span><span class="s1">(sec &lt; </span><span class="s6">10</span><span class="s1">){ 
            time = time + </span><span class="s5">&quot;:&quot;</span><span class="s1">+</span><span class="s5">&quot;0&quot;</span><span class="s1">+sec</span><span class="s2">;</span><span class="s1"> 
        }</span><span class="s2">else</span><span class="s1">{ 
            time = time+</span><span class="s5">&quot;:&quot;</span><span class="s1">+sec</span><span class="s2">;</span><span class="s1"> 
        } 
 
        </span><span class="s2">return </span><span class="s1">time</span><span class="s2">;</span><span class="s1"> 
    }</span><span class="s4">//setTimeWithInt</span><span class="s1"> 
 
 
   </span><span class="s2">public </span><span class="s1">String calculateTotalTime(</span><span class="s2">int </span><span class="s1">id){ 
       String time = </span><span class="s5">&quot;00:00&quot;</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s4">//get a realm Instance</span><span class="s1"> 
       realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s4">//get Training with the id</span><span class="s1"> 
       Training t = getATrainingWithID(id)</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s4">//we get the List of Rows</span><span class="s1"> 
       </span><span class="s2">int </span><span class="s1">totalSec = </span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s2">int </span><span class="s1">totalMin = </span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
 
       </span><span class="s2">for</span><span class="s1">(TrainingRow row : t.getRlst_row()){ 
           </span><span class="s2">int </span><span class="s1">min = row.getInt_min()</span><span class="s2">;</span><span class="s1"> 
           </span><span class="s2">int </span><span class="s1">sec = row.getInt_sec()</span><span class="s2">;</span><span class="s1"> 
           </span><span class="s4">//total of minutes and seconds</span><span class="s1"> 
           totalSec += sec</span><span class="s2">;</span><span class="s1"> 
           totalMin += min</span><span class="s2">;</span><span class="s1"> 
       } 
 
       </span><span class="s2">int </span><span class="s1">hour = totalMin / </span><span class="s6">60</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s2">int </span><span class="s1">min = totalMin % </span><span class="s6">60</span><span class="s2">;</span><span class="s1"> 
       min += totalSec / </span><span class="s6">60</span><span class="s2">;</span><span class="s1"> 
       </span><span class="s2">int </span><span class="s1">sec = totalSec%</span><span class="s6">60</span><span class="s2">;</span><span class="s1"> 
 
       time = </span><span class="s5">&quot;&quot;</span><span class="s1">+hour+</span><span class="s5">&quot;:&quot;</span><span class="s1">+min +</span><span class="s5">&quot;:&quot;</span><span class="s1">+sec</span><span class="s2">;</span><span class="s1"> 
 
       </span><span class="s2">return </span><span class="s1">time</span><span class="s2">;</span><span class="s1"> 
   } 
 
    </span><span class="s0">/*** 
     * 
     * </span><span class="s3">@param </span><span class="s0">id 
     * </span><span class="s3">@return</span><span class="s0"> 
     * 
     */</span><span class="s1"> 
    </span><span class="s2">public </span><span class="s1">List&lt;Integer&gt; calculateTotalMinAndSec(</span><span class="s2">int </span><span class="s1">id){ 
        List&lt;Integer&gt; lst_time = </span><span class="s2">new </span><span class="s1">ArrayList&lt;&gt;()</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get a realm Instance</span><span class="s1"> 
        realm = Realm.getInstance(context)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//get Training with the id</span><span class="s1"> 
        Training t = getATrainingWithID(id)</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s4">//we get the List of Rows</span><span class="s1"> 
        </span><span class="s2">int </span><span class="s1">totalSec = </span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
        </span><span class="s2">int </span><span class="s1">totalMin = </span><span class="s6">0</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s2">for</span><span class="s1">(TrainingRow row : t.getRlst_row()){ 
            </span><span class="s2">int </span><span class="s1">min = row.getInt_min()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s2">int </span><span class="s1">sec = row.getInt_sec()</span><span class="s2">;</span><span class="s1"> 
            </span><span class="s4">//total of minutes and seconds</span><span class="s1"> 
            totalSec += sec</span><span class="s2">;</span><span class="s1"> 
            totalMin += min</span><span class="s2">;</span><span class="s1"> 
        } 
        </span><span class="s4">//adding the two int in the ArrayList</span><span class="s1"> 
        lst_time.add(totalMin)</span><span class="s2">;</span><span class="s1"> 
        lst_time.add(totalSec)</span><span class="s2">;</span><span class="s1"> 
 
        </span><span class="s4">//return the arrayList</span><span class="s1"> 
        </span><span class="s2">return </span><span class="s1">lst_time</span><span class="s2">;</span><span class="s1"> 
    } 
}</span></pre>
</body>
</html>